function copy(a){return angular.isObject(a)&&!angular.isFunction(a)?JSON.parse(JSON.stringify(a)):angular.copy(a)}function createScope(a){var b=mox.inject("$rootScope").$new();return a&&angular.extend(b,a),currentSpec.$scope=b,b}function createController(a,b,c){return mox.inject("$controller")(a,angular.extend({$scope:b||currentSpec.$scope},c||{}))}function mockDate(a){var b;beforeEach(function(){b=sinon.useFakeTimers(+new Date(a))}),afterEach(function(){b.restore()})}function getMockData(a){return copy(getJSONFixture(a))}function noop(){}function compileHtml(a,b,c){b=b||currentSpec.$scope,void 0===c&&(c=!0);var d=mox.inject("$compile")(a)(b),e=angular.element(document.body);if(e.find(mox.testTemplateAppendSelector).remove(),c){var f=mox.testTemplatePath?jasmine.getFixtures().read(mox.testTemplatePath):angular.element('<div id="mox-container">');e.append(f).find(mox.testTemplateAppendSelector).append(d)}return currentSpec.element=d,b.$digest(),currentSpec.element}function compileTemplate(a,b,c){var d=mox.inject("$templateCache").get(a);return compileHtml("<div>"+d+"</div>",b,c)}function compileHtmlOnDom(a,b){var c=compileHtml(a,b),d=mox.inject("$document").find("body"),e="test-input-container",f=function(){return d.find("#"+e)};return f().length<1&&d.append('<div id="'+e+'"></div>'),f().append(c),c}function removeCompiledHtmlFromDom(){return mox.inject("$document").find("body").find("#test-input-container").remove()}function defer(){return mox.inject("$q").defer()}function when(){return mox.inject("$q").when.apply(this,arguments)}function all(){return mox.inject("$q").all.apply(this,arguments)}function unresolvedPromise(){return defer().promise}function promise(a,b){var c=defer();return c.resolve(b?a:copy(a)),c.promise}function restangularPromise(a){return mox.inject("$q").when(angular.copy(a))}function resourcePromise(a){var b=defer();return b.resolve(angular.copy(a)),b.promise}function reject(a){return mox.inject("$q").reject(a)}function resourceResult(a,b){return angular.forEach(b,function(b,c){"$"===c[0]&&(a[c]=b)}),{$promise:b?resourcePromise(a):promise(a)}}function nonResolvingResourceResult(){return{$promise:unresolvedPromise()}}function rejectingResourceResult(a){return{$promise:reject(a)}}function extendElement(a){return a.findBinding=function(b){var c=a.find(".ng-binding"),d=[];return angular.forEach(c,function(a){var c=angular.element(a).data("$binding");if(c){var e=c.exp||c[0].exp||c;-1!==e.indexOf(b)&&d.push(a)}}),angular.element(d)},a}function extendedElement(a,b){var c={};return angular.forEach(b,function(b,d){c[d]=a.find(b)}),angular.extend(a,c)}function extendedElementWithChildren(a,b){var c=[];angular.forEach(a.children(),function(a){c.push(angular.element(a))});var d={};return angular.forEach(c,function(a,c){d[b[c]]=a}),angular.extend(a,d)}function addSelectors(a,b){function c(a,b,c){var d=a[b];if(angular.isUndefined(d))a[b]=c;else if(!angular.isFunction(d)||"moxExtendElement"!==d.name)throw Error("Property "+b+" already defined on element")}function d(a,b){angular.forEach(b,function(b,d){var e=angular.isObject(b)?b.name:b,f=b.sub;c(a,e,function(){var b=a.children().eq(d);return addSelectors(b,f),b})})}function e(a,b,c){if(b){if(angular.isString(b)||b.selector){var d=(b.selector||b).replace(/{(\d+)}/g,function(a,b){return c[b]});return a.find(d)}if(b.repeater){var e=a.find(b.repeater);return angular.isDefined(c[0])?e.eq(c[0]):e}}return angular.element(a)}return angular.forEach(b,function(b,f){var g=b.children,h=b.sub;c(a,f,function(){var c=e(a,b,arguments);return(!b.repeater||angular.isDefined(arguments[0]))&&(addSelectors(c,h),d(c,g)),c})}),a}function requestTest(){function a(a){return b._expectedQueryParams?(expect(a).toHaveQueryParams(b._expectedQueryParams),b._path?a.indexOf(b._path)>=0:!0):b._path===a}var b={_httpMethod:"GET",_data:null};return b._expectedResult=b._response,b.whenPath=function(a){return b._path=a,b},b.whenMethod=function(a){return b._method=a,b._methodArguments=Array.prototype.slice.call(arguments,1),b},b.whenCall=b.whenMethod,b.whenHttpMethod=function(a){return b._httpMethod=a,b},b.whenData=function(a){return b._data=a,b},b.expectRequest=function(a,c,d){return b.whenHttpMethod(a),b.whenPath(c),b.whenData(d),b},b.andRespond=function(a){return b._response=a,b._expectedResult=b._response,b},b.andExpect=function(a){return b._expectedResult=a,b},b.expectGet=function(a){return b.expectRequest("GET",a)},b.expectPost=function(a,c){return b.expectRequest("POST",a,c)},b.expectPut=function(a,c){return b.expectRequest("PUT",a,c)},b.expectDelete=function(a,c){return b.expectRequest("DELETE",a,c)},b.expectQueryParams=function(a){return b._expectedQueryParams=a,b},b.fail=function(){b._expectFail=!0,b.run()},b.run=function(){b._response=b._response||{},mox.inject("$httpBackend").expect(b._httpMethod,{test:a},b._data).respond(b._response);var c=b._method.apply(this,b._methodArguments),d=c.$promise||c;if(angular.isFunction(b._expectedResult)){var e=jasmine.createSpy("success callback"),f=jasmine.createSpy("failure callback");d.then(e)["catch"](f),mox.inject("$httpBackend").flush(),b._expectedResult((b._expectFail?f:e).mostRecentCall.args[0])}else mox.inject("$httpBackend").flush(),b._expectFail?expect(d).toReject():expect(d).toResolve()},b}function MoxBuilder(){function a(){var a;return e.length&&(a=angular.mock.module.apply(this,e),angular.mock.inject()),f.forEach(function(a){a()}),a}function b(){d=[],e=[],f=[]}function c(a){if(!a[0])throw Error("Please provide arguments")}var d,e,f;return b(),this.factories=moxConfig,this.get={},this.testTemplateAppendSelector="#mox-container",this.inject=function(a){if(!currentSpec.$injector)throw Error("Sorry, cannot inject "+a+" because the injector is not ready yet. Please call mox.run() or inject()");var b=Array.prototype.slice.call(arguments,0),c={};return angular.forEach(b,function(a){c[a]=currentSpec.$injector.get(a)}),1===b.length?c[a]:c},this.module=function(){var a=Array.prototype.slice.call(arguments,0);return angular.forEach(a,function(a){angular.isString(a)&&d.push(a)}),e=e.concat(a),this},this.mockServices=function(){function a(a){if(!angular.isFunction(a)||"Resource"===a.name){var b=[];return angular.forEach(a,function(a,c){angular.isFunction(a)&&b.push(c)}),b}}c(arguments);var b=arguments;return e.push(function(c){var e=angular.injector(["ng","ngMock"].concat(d));angular.forEach(b,function(b){var d;if(angular.isArray(b)?(d=angular.copy(b),b=d.shift(),d.unshift(c)):d=[c],b in mox.factories)mox.factories[b].apply(this,d);else{var f=e.get(b);if("Resource"===f.name)mox.createResourceMock(b,a(f))(c);else{var g=angular.isFunction(f)?a(f):void 0;mox.createMock(b,g)(c)}}})}),this},this.mockConstants=function(a){if(c(arguments),angular.isString(a)){var b=arguments[0];a={},a[b]=arguments[1]}return e.push(function(b){angular.forEach(a,function(a,c){mox.save(b,c,a,"constant")})}),this},this.mockDirectives=function(){c(arguments);var a=arguments;return e.push(function(b){angular.forEach(a,function(a){var c=angular.isString(a)?{name:a}:a;b.decorator(c.name+"Directive",function(a){return angular.extend(c,{name:a[0].name,$$isolateBindings:a[0].$$isolateBindings,scope:a[0].scope,index:a[0].index,priority:a[0].priority,restrict:a[0].restrict}),[c]})})}),this},this.disableDirectives=function(){c(arguments);var a=arguments;return e.push(function(b){angular.forEach(a,function(a){b.factory(a+"Directive",function(){return{}})})}),this},this.mockControllers=function(){c(arguments);var a=arguments;return e.push(function(b){angular.forEach(a,function(a){b.register(a,angular.noop)})}),this},this.mockTemplates=function(){c(arguments);var a=arguments;return f.push(function(){var b=mox.inject("$templateCache");angular.forEach(a,function(a){var c,d;angular.isString(a)?(c=a,d="<div>This is a mock for "+c+"</div>"):angular.forEach(a,function(a,b){d=a,c=b}),b.put(c,d)})}),this},this.setupResults=function(a){return f.push(function(){var b=a();angular.forEach(b,function(a,b){function c(a,b){"function"==typeof b?currentSpec.isJasmine2?a.and.callFake(b):a.andCallFake(b):currentSpec.isJasmine2?a.and.returnValue(b):a.andReturn(b)}var d;if(!(b in mox.get))throw new Error(b+" is not in mox.get");d=mox.get[b],"object"==typeof a&&a.constructor===Object?angular.forEach(a,function(a,e){if(!(e in d))throw new Error("Could not mock return value. No method "+e+" created in mock for "+b);c(d[e],a)}):c(d,a)})}),this},this.run=function(){var c=a();return b(),c},this.save=function(a,b,c,d){return d=d||"value",a[d](b,c),mox.get[b]=c,c},this.createMock=function(a,b){return function(c,d){var e=b?b.length?jasmine.createSpyObj(a,b):jasmine.createSpy(a):void 0;return c&&mox.save(c,d||a,e,b?void 0:"constant"),e}},this.createResourceMock=function(a,b){function c(a){d[a]=a,d["$"+a]="$"+a}var d={};return angular.forEach(b,c),d.constructor="constructor",function(b){var c=jasmine.createSpyObj(a,Object.keys(d)),e=function(a){return angular.extend({},c,a)};return currentSpec.isJasmine2?c.constructor.and.callFake(e):c.constructor.andCallFake(e),angular.extend(c.constructor,c),b&&(b.value(a,c.constructor),mox.get[a]=c),c.constructor}},this}var currentSpec;beforeEach(function(){this.isJasmine2=/^2/.test(jasmine.version),currentSpec=this}),"undefined"!=typeof beforeAll&&(angular.mock.clearDataCache=angular.noop);var moxConfig={};angular.module("mox",[]).service("Mox",MoxBuilder);var mox=angular.injector(["mox"]).get("Mox");